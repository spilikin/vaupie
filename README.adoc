= üç∞ vaupie: Command line VAU client

= About

`üç∞ vaupie` implements the https://github.com/gematik/api-erp/blob/master/docs/authentisieren.adoc#verschl√ºsselter-transportkanal-zur-vertrauensw√ºrdigen-ausf√ºhrungsumgebung-vau-transport[gematik VAU protocol] for ePrescription. It is designed to be used in combination with https://httpie.org[HTTPie] and https://github.com/gematik/ref-eRp-FD-Server[gematik reference implementation ePrescription Server]. 

`HTTPie` provides the `--offline` option, which enables us to generate any HTTP-Request which is then encrypted by the `üç∞ vaupie` and sent to the eRezept service like that:

[source,bash]
----
http --offline get vau/Task "`./vau.py auth`"|./vau.py req
----

= Usage

== Install and configure the server

Install https://www.rust-lang.org/learn/get-started[Rust]

.Clone repository from github
[source,bash]
----
git clone https://github.com/gematik/ref-eRp-FD-Server.git
cd ref-eRp-FD-Server
----


.Generate key pair and certificate usinf openssl 
[source,bash]
----
# generate key pair for VAU
openssl ecparam -name brainpoolP256r1 -genkey -out vau-key.pem
# IMPORTANT: use 'localhost' as Common Name, you can leave other fields empty
openssl req -new -x509 -key vau-key.pem -out vau-cert.pem -days 30
# display the VAU certificate
openssl x509 -in vau-cert.pem -text
----

.Start server 
[source,bash]
----
cargo run -p ref-erx-fd-server -- --vau-key vau-key.pem --vau-cert vau-cert.pem
----

.Test if server works
[source,bash]
----
# fetch VAU certificate from server and display it
http localhost:3000/VAUCertificate|openssl x509 -inform der -text
----

== Virtual environment

[source,bash]
----
source venv.sh
----


== Initialise the VAU state
[source,bash]
----
./vau.py init http://localhost:3000/ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
----

== Perform request
[source,bash]
----
http --offline get vau/Task "`./vau.py auth`"|./vau.py req
----

